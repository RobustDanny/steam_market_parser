<!DOCTYPE html>
<html>
<head>
    <title>Steam Market - Most Recent Items</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .item.new {
            background-color: #e8f5e9;
        }
        .price {
            color: #4CAF50;
            font-weight: bold;
        }
        .status {
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .updated {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>Most Recent Steam Market Items</h1>
    
    <div class="status">
        <p>Total listings: <span id="listing-count">{{ items.listinginfo | length }}</span></p>
        <p>Last updated: <span id="last-update">Just now</span></p>
        <p><small>Auto-updates every 5 seconds (without page reload)</small></p>
    </div>
    
    <div id="items-container" class="items-container">
        {% for listing_id, listing in items.listinginfo %}
            <div class="item" data-id="{{ listing.listingid }}">
                <p><strong>Listing ID:</strong> {{ listing.listingid }}</p>
                <p><strong>Price:</strong> <span class="price">{{ listing.price }}</span> (Currency: {{ listing.currencyid }})</p>
                <p><strong>Fee:</strong> {{ listing.fee }}</p>
                <p><strong>Asset ID:</strong> {{ listing.asset.id }}</p>
            </div>
        {% endfor %}
    </div>

    <script>
        let lastUpdateTime = Date.now();

        function updateLastUpdateTime() {
            const now = Date.now();
            const seconds = Math.floor((now - lastUpdateTime) / 1000);
            document.getElementById('last-update').textContent = `${seconds} seconds ago`;
        }

        async function fetchNewItems() {
            try {
                const response = await fetch('/api/items');
                const data = await response.json();
                
                // Update listing count
                document.getElementById('listing-count').textContent = 
                    Object.keys(data.listinginfo).length;
                
                // Update items container
                const container = document.getElementById('items-container');
                container.innerHTML = '';
                
                for (const [listingId, listing] of Object.entries(data.listinginfo)) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item new';
                    itemDiv.innerHTML = `
                        <p><strong>Listing ID:</strong> ${listing.listingid}</p>
                        <p><strong>Price:</strong> <span class="price">${listing.price}</span> (Currency: ${listing.currencyid})</p>
                        <p><strong>Fee:</strong> ${listing.fee}</p>
                        <p><strong>Asset ID:</strong> ${listing.asset.id}</p>
                    `;
                    container.appendChild(itemDiv);
                    
                    // Remove highlight after animation
                    setTimeout(() => itemDiv.classList.remove('new'), 1000);
                }
                
                lastUpdateTime = Date.now();
            } catch (error) {
                console.error('Error fetching items:', error);
            }
        }

        // Fetch new items every 5 seconds
        setInterval(fetchNewItems, 5000);
        
        // Update "last updated" timestamp every second
        setInterval(updateLastUpdateTime, 1000);
    </script>
</body>
</html>