<!DOCTYPE html>
<html>
<head>
    <title>Realtime Cards</title>

<style>
/*Filters*/

/* From Uiverse.io by R1SH4BH81 */ 
/* Body */
.container {
  display: grid;
  grid-template-columns: auto;
  gap: 0px;
}

hr {
  height: 1px;
  background-color: #2e2e2e; /* Dark gray line */
  border: none;
}

.filter_card {
  width: 100%;
  background: #1c1c1c; /* Dark background for a professional look */
  box-shadow:
    0px 187px 75px rgba(0, 0, 0, 0.01),
    0px 105px 63px rgba(0, 0, 0, 0.05),
    0px 47px 47px rgba(0, 0, 0, 0.09),
    0px 12px 26px rgba(0, 0, 0, 0.1),
    0px 0px 0px rgba(0, 0, 0, 0.1);
}

.title {
  width: 100%;
  height: 40px;
  position: relative;
  display: flex;
  align-items: center;
  padding-left: 20px;
  border-bottom: 1px solid #2e2e2e; /* Dark gray */
  font-weight: 700;
  font-size: 11px;
  color: #ffffff; /* White text */
}

/* Cart */
.cart {
  border-radius: 19px 19px 0px 0px;
}

.cart .steps {
  display: flex;
  flex-direction: column;
  padding: 20px;
}

.cart .steps .step {
  display: grid;
  gap: 10px;
}

.cart .steps .step span {
  font-size: 13px;
  font-weight: 600;
  color: #ffffff; /* White text */
  margin-bottom: 8px;
  display: block;
}

.cart .steps .step p {
  font-size: 11px;
  font-weight: 600;
  color: #bbbbbb; /* Light gray text */
}

/* Promo */
.promo form {
  display: grid;
  grid-template-columns: 1fr 80px;
  gap: 10px;
  padding: 0px;
}

.input_field {
  width: auto;
  height: 36px;
  padding: 0 0 0 12px;
  border-radius: 5px;
  outline: none;
  border: 1px solid #2e2e2e; /* Dark gray */
  background-color: #333333; /* Dark input background */
  color: #ffffff; /* White text */
  /* transition: all 0.3s cubic-bezier(0.15, 0.83, 0.66, 1); */
}

.input_field:focus {
  border: 1px solid transparent;
  box-shadow: 0px 0px 0px 2px #555555; /* Light gray focus */
  background-color: #333333;
}

.promo form button {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  padding: 10px 18px;
  gap: 10px;
  width: 100%;
  height: 36px;
  background: #555555; /* Medium gray button */
  box-shadow:
    0px 0.5px 0.5px #555555,
    0px 1px 0.5px rgba(239, 239, 239, 0.5);
  border-radius: 5px;
  border: 0;
  font-weight: 600;
  font-size: 12px;
  line-height: 15px;
  color: #ffffff; /* White text */
  transition: all 0.3s cubic-bezier(0.15, 0.83, 0.66, 1);
}

/* Checkout */
.payments .details {
  display: grid;
  grid-template-columns: 10fr 1fr;
  padding: 0px;
  gap: 5px;
}

.payments .details span:nth-child(odd) {
  font-size: 12px;
  font-weight: 600;
  color: #ffffff; /* White text */
}

.payments .details span:nth-child(even) {
  font-size: 13px;
  font-weight: 600;
  color: #bbbbbb; /* Light gray text */
}

.checkout .footer {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px 10px 10px 20px;
  background-color: #1c1c1c; /* Dark gray background */
}

.price {
  font-size: 22px;
  color: #ffffff; /* White text */
  font-weight: 900;
}

.checkout .checkout-btn {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 150px;
  height: 36px;
  background: #555555; /* Medium gray button */
  border-radius: 7px;
  border: 1px solid #2e2e2e; /* Dark gray border */
  color: #ffffff; /* White text */
  font-size: 13px;
  font-weight: 600;
  /* transition: all 0.3s cubic-bezier(0.15, 0.83, 0.66, 1); */
}

.checkout .checkout-btn:hover {
  background-color: #777777; /* Slightly lighter gray on hover */
}


/* ==== Your card CSS (unchanged) ==== */
.side_panel_filter_icon{
  /* justify-self: normal; */
  /* padding-left: 10%; */
}

.card {
 width: 80px;
 height: 90px;
 border-radius: 10px;
 background: #212121;
 position: relative;
 padding: 1.8rem;
 border: 1px solid #323232;
 transition: 0.5s ease-out;
 /* overflow: hidden; */
 margin: 0.4rem;
}
.card-details {
 color: black;
 height: 100%;
 gap: .5em;
 display: grid;
 place-content: center;
 
}
.card-button {
 transform: translate(-50%, 125%);
 width: 60%;
 border-radius: 1rem;
 border: none;
 background-color: #72addb;
 color: #fff;
 font-size: 1rem;
 padding: .5rem 1rem;
 position: absolute;
 left: 50%;
 bottom: 0;
 opacity: 0;
 transition: 0.3s ease-out;
}
.game_icon{
    position: absolute;
    top: 7px;
    right: 25px;
    width: 16px;
    height: 16px;
}

.more_icon{
    position: absolute;
    top: 7px;
    right: 5px;
    width: 16px;
    height: 16px;
}

.tooltip_icon{
    cursor: pointer;
    /* position: absolute;
    top: 5px;
    right: 5px; */
    width: 16px;
    height: 16px; 
}

.locker_icon{
    position: absolute;
    top: 5px;
    left: 5px;
    width: 16px;
    height: 16px;
}

.text-price {
 color: #9E9E9E;
 /* font-size: 0.5em; */
 font-size: 0.7em;
 position: absolute;
 /* top: 5px;
 left: 5px; */
 bottom: 9px;
 justify-self: center;
}
.text-title {
 padding-left: 5px;
 padding-right: 5px;
 font-size: 0.6em;
 font-weight: bold;
 position: absolute;
 justify-self: center;
 bottom: 10px;
 color: #F9F8F6;
}
.card_hover-container {
  /* position: relative; */
  display: inline-block;
  /* display: flex; */
  cursor: default;

}

.hidden-text {
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 5px 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 1000;
}

.tooltip_actions{
  position: absolute;
  bottom: 60%;
  left: 112%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  gap: 0.5em;
  visibility: hidden;
  display: flex;          
  flex-direction: column; 
  align-items: center; 
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 10;
}

/*change z-index*/
.arrow_up_cont{
  width: 30px;
  height: 30px;
  display: flex;
  border-radius: 100%;
  border: 1px solid #323232;
  background-color: #212121;
  position: absolute;
  justify-content: center;
  align-items: center;
  right: calc(2% + 5px);
  top: calc(50% - 37px);
  z-index: 1010;
}

.arrow_down_cont{
  width: 30px;
  height: 30px;
  display: flex;
  border-radius: 100%;
  border: 1px solid #323232;
  background-color: #212121;
  position: absolute;
  justify-content: center;
  align-items: center;
  right: calc(2% + 5px);
  top: calc(50% + 47px);
  z-index: 101;
}

.arrows_icons{
  width: 15px;
  height: 15px;
}

.arrow_down_cont:hover .hidden-text{
  opacity: 1;
  visibility: visible;
}

.arrow_up_cont:hover .hidden-text{
  opacity: 1;
  visibility: visible;
}

.card_tooltip-container:hover .tooltip_actions {
  opacity: 1;
  visibility: visible;
}

.card_hover-container:hover .hidden-text {
  opacity: 1;
  visibility: visible;
}

.card:hover {
 border-color: #E69066;
 box-shadow: 0 4px 18px 0 rgba(0, 0, 0, 0.25);
}
.card:hover .card-button {
 transform: translate(-50%, 50%);
 opacity: 1;
}

.side_panel_icons{
  display: flex;          
  flex-direction: column; 
  /* align-items: center;  */
  transition: width 0.3s ease;
}

.side_panel_icon{
  justify-self: center;
  margin-left: 10%;
  margin-top: 20px;
  width: 20px;
  height: 20px;
}

.media_icons_play_cont{
  width: 40px;
  height: 40px;
  display: flex;
  border-radius: 100%;
  border: 1px solid #323232;
  background-color: #212121;
  position: absolute;
  justify-content: center;
  align-items: center;
  right: 2%;
  top: 50%;
  z-index: 1000;
  visibility: hidden;
}

.media_icons_pause_cont{
  border-radius: 100%;
  display: flex;
  width: 40px;
  height: 40px;
  border: 1px solid #323232;
  background-color: #212121;
  position: absolute;
  align-items: center;
  justify-content: center;
  right: 2%;
  top: 50%;
  z-index: 1000;
  visibility: visible;
}

.play_icon{
  /* position: relative; */
  width: 20px;
  height: 20px;
}

.media_icons_pause_cont:hover .hidden-text{
  opacity: 1;
  visibility: visible;
}

.media_icons_play_cont:hover .hidden-text{
  opacity: 1;
  visibility: visible;
}

.pause_icon{
  justify-self: center;
  align-self: center;
  width: 20px;
  height: 20px;
}

.side_panel:hover .filters{
    opacity: 1;
    visibility: visible;
    transition: width 0.8s ease;
}

.filters{
    justify-self: center;
    visibility: hidden;
    margin: auto;
    /* z-index: 1000; */
    transition: width 0.3s ease;
}

.item_icon{
    padding-left: 5px;
    padding-right: 5px;
    width: auto;
    height: 70px;
    /* position: absolute; */
    justify-self: center;
    align-self: center;    
}
.side_panel {
    position: fixed;
    padding-top: 20px;
    left: 0;
    top: 0;
    width: 3%;
    height: 100vh;
    background: #141414;
    border: 1px solid #323232;
    color: white;
    /* padding: 20px; */
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    z-index: 100;
    transition: width 0.3s ease;
}

.head_panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 3%;
    background: #141414;
    border: 1px solid #323232;
    color: white;
    /* padding: 20px; */
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    z-index: 99;
    transition: width 0.3s ease;
}

.head_panel:hover{
  height: 10%;
}

.side_panel:hover {
    width: 15%;
}

.items-container {
        width: 95%;
        padding: 20px;
        margin-left: auto;
        display: flex;
        justify-content: center;
        /* justify-self: center; */
        flex-wrap: wrap;
}
</style>

</head>

<body style="background-color: #141414;
overflow-x: hidden;">

<script>
const ws = new WebSocket("ws://127.0.0.1:8080/ws");

ws.onopen = () => console.log("WS CONNECTED");
ws.onclose = () => console.log("WS CLOSED");
ws.onerror = (err) => console.log("WS ERROR", err);

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  const items = data.items;
  const userAds = data.user_ads;

  console.log("ADS:", userAds);
    // const filters = data.filters;
    // const items = data.items;
    console.log("Received update:", items);

    const container = document.getElementById("items-container");

    const adsContainer = document.getElementById("ads-container");
adsContainer.innerHTML = "";

userAds.forEach(ad => {
    adsContainer.insertAdjacentHTML("beforeend", `
        <div class="ad-box">
            <img src="${ad.image}" style="width:40px;height:40px;border-radius:50%">
            <span>${ad.name}</span>
        </div>
    `);
});

    items.forEach(item => {

        // if (item.game === "Steam") {
        //     item.game_icon = "/front/svg/steam_icon.svg";
        // }
        // else if(item.game === "Counter-Strike 2"){
        //     item.game_icon = "/front/svg/cs2_icon.svg";
        // }
        // else if(item.game === "Dota 2"){
        //     item.game_icon = "/front/svg/dota2_icon.svg";
        // }

        // if(filters.appid === item.game){
            container.insertAdjacentHTML("afterbegin", `
    <div class="card_hover-container">
        <div class="card">
            <div class="card-details">
                <img class="game_icon" src="${item.game_icon}">
            <div>

            <div class="card_tooltip-container">
                <img class="more_icon" src="/front/svg/more_icon.svg">

                <span class="tooltip_actions">
                    <a href="https://steamcommunity.com/market/listings/${item.appid}/${item.market_hash_name}"
                    target="_blank" rel="noopener noreferrer">
                    <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                    </a>
                    <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                </span>
            </div>
            <div style="overflow: hidden;">
            <img src="https://steamcommunity.com/economy/image/${ item.icon }" alt="${ item.name }" class="item_icon">
            </div>
            </div>
            <span class="hidden-text">${item.name}</span>
            <span class="text-price">$${item.price}</span>
            </div>
        </div>
    </div>
`);
        // }
        

    });
};
</script>

<script>
    function updateFilters() {
    
        const msg = {
            type: "filters",
            appid: document.getElementById("f_appid").value,
            price_min: document.getElementById("f_min").value,
            price_max: document.getElementById("f_max").value,
            query: document.getElementById("f_query").value,
        }
        ws.send(JSON.stringify(msg));
        
        const url = `/filters?appid=${msg.appid}&price_min=${msg.price_min}&price_max=${msg.price_max}&query=${msg.query}`;
    
        fetch(url)
            .then(res => res.json())
            .then(json => {
                console.log("Filters updated:", json);
            });
    }
    </script>
    
    <div id="ads-container"></div>

<!-- === INITIAL TERA RENDER === -->
<div class="side_panel">
        <div class="side_panel_filter_icon">
          <!-- <img class="side_panel_icon" src="/front/svg/filter_icon.svg"> -->

          <div class="filters">
            <div class="filter_card cart">
                <div class="steps">
                  <div class="step">
                    <hr />
                    <input
                    id="f_appid"
                    class="input_field"
                    placeholder="Enter a game"
                    type="text"
                  />
                  <hr />
                  <input
                    id="f_query"
                    class="input_field"
                    placeholder="Enter a query"
                    type="text"
                  />
                    <hr />
                  <label>min price</label>
                    <input
                    id="f_min"
                    type="range"
                    min="0"
                    max="9999999"
                    value="0"
                  />
                  <hr />
                  <label>max price</label>
                    <input
                    id="f_max"
                    min="0"
                    max="9999999"
                    value="9999999"
                    type="range"
                  />
                  <!-- <hr /> -->
                  </div>
                </div>
      
            </div>
            <div class="filter_card checkout">
                <div class="footer">
                  <button class="checkout-btn" onclick="updateFilters()">Apply</button>
                </div>
            </div>
        </div>
        </div>

        <!-- <img class="side_panel_icon" src="/front/svg/chart_icon.svg">
        <img class="side_panel_icon" src="/front/svg/budget_icon.svg"> -->
    
</div>

<div class="head_panel">
</div>

<div class="media_icons_pause_cont">
  <img class="pause_icon" src="/front/svg/pause_icon.svg">
  <span class="hidden-text">Pause feed</span>
</div>

<div class="media_icons_play_cont">
  <img class="play_icon" src="/front/svg/play_icon.svg">
  <span class="hidden-text">Resume feed</span>
</div>

<div class="arrow_up_cont">
  <img class="arrows_icons" src="/front/svg/arrow_up.svg">
  <span class="hidden-text">Next changed filter</span>
</div>

<div class="arrow_down_cont">
    <img class="arrows_icons" src="/front/svg/arrow_down.svg">
    <span class="hidden-text">Previous changed filter</span>
</div>

<div id="items-container" class="items-container">    
{% for item in most_recent_items %}
        {% if filters.appid == item.game %}
        <div class="card_hover-container">

        <div class="card">
            <div class="card-details">
                <span class="text-price">${{ item.price }}</span>

                <div class="card_tooltip-container">
                    <img class="more_icon" src="/front/svg/more_icon.svg">
    
                    <span class="tooltip_actions">
                        <a href="https://steamcommunity.com/market/listings/{{item.appid}}/{{item.market_hash_name}}"
                        target="_blank" rel="noopener noreferrer">
                        <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                        </a>
                        <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                    </span>
                </div>

                {% if item.tradable == "1" %}
                <img class="locker_icon" src="/front/svg/locker_icon.svg">
                {% endif %}
                
                <div>
                    <img class="game_icon" src="{{ item.game_icon }}">
                    <!-- <span class="hidden-text">{{item.game}}</span> -->
                </div>
                <div style="display: flex;
                box-sizing: content-box;">
                    <img src="https://steamcommunity.com/economy/image/{{ item.icon }}" alt="{{ item.name }}" class="item_icon">
                </div>
                <!-- <span class="text-title">{{ item.name }}</span> -->
                <span class="hidden-text">{{item.name}}</span>
            </div>
        </div>

        </div>
        {% endif %}
{% endfor %}
</div>
</div>

</body>
</html>
