<!DOCTYPE html>
<html>
<head>
    <title>Realtime Cards</title>

<style>
/* ==== Your card CSS (unchanged) ==== */
.card {
 width: 80px;
 height: 90px;
 border-radius: 10px;
 background: #5f5e5e;
 position: relative;
 padding: 1.8rem;
 border: 2px solid #c3c6ce;
 transition: 0.5s ease-out;
 /* overflow: hidden; */
 margin: 0.4rem;
}
.card-details {
 color: black;
 height: 100%;
 gap: .5em;
 display: grid;
 place-content: center;
 
}
.card-button {
 transform: translate(-50%, 125%);
 width: 60%;
 border-radius: 1rem;
 border: none;
 background-color: #72addb;
 color: #fff;
 font-size: 1rem;
 padding: .5rem 1rem;
 position: absolute;
 left: 50%;
 bottom: 0;
 opacity: 0;
 transition: 0.3s ease-out;
}
.game_icon{
    position: absolute;
    top: 5px;
    right: 30px;
    width: 20px;
    height: 20px;
}

.more_icon{
    position: absolute;
    top: 5px;
    right: 5px;
    width: 20px;
    height: 20px;
}

.tooltip_icon{
    cursor: pointer;
    /* position: absolute;
    top: 5px;
    right: 5px; */
    width: 20px;
    height: 20px; 
}

.locker_icon{
    position: absolute;
    top: 15px;
    left: 15px;
    width: 20px;
    height: 20px;
}

.text-price {
 color: rgb(134, 134, 134);
 font-size: 0.5em;
 position: absolute;
 top: 5px;
 left: 5px;
}
.text-title {
 padding-left: 5px;
 padding-right: 5px;
 font-size: 0.6em;
 font-weight: bold;
 position: absolute;
 justify-self: center;
 bottom: 10px;
}
.card_hover-container {
  /* position: relative; */
  display: inline-block;
  /* display: flex; */
}

.hidden-text {
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 5px 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 10;
}

.tooltip_actions{
  position: absolute;
  bottom: 80%;
  left: 115%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 5px 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  visibility: hidden;
  display: flex;          
  flex-direction: column; 
  align-items: center; 
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 10;
}

.card_tooltip-container:hover .tooltip_actions {
  opacity: 1;
  visibility: visible;
}

.card_hover-container:hover .hidden-text {
  opacity: 1;
  visibility: visible;
}

.card:hover {
 border-color: #6697be;
 box-shadow: 0 4px 18px 0 rgba(0, 0, 0, 0.25);
}
.card:hover .card-button {
 transform: translate(-50%, 50%);
 opacity: 1;
}
.item_icon{
    padding-left: 5px;
    padding-right: 5px;
    width: auto;
    height: 70px;
    /* position: absolute; */
    justify-self: center;
    align-self: center;    
}
.side_panel {
    position: fixed;
    left: 0;
    top: 0;
    width: 3%;
    height: 100vh;
    background: #1c2025;
    color: white;
    /* padding: 20px; */
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    transform: translateX(0);
    transition: transform 0.3s ease;
    /* z-index: 100; */
}

.items-container {
        width: 95%;
        padding: 20px;
        margin-left: auto;
        display: flex;
        justify-content: center;
        /* justify-self: center; */
        flex-wrap: wrap;
}
</style>

</head>

<body style="background-color: #28323e;">

<script>
const ws = new WebSocket("ws://127.0.0.1:8080/ws");

ws.onmessage = (event) => {
    const items = JSON.parse(event.data);
    // const filters = JSON.parse(event.data);
    console.log("Received update:", items);

    const container = document.getElementById("items-container");

    items.forEach(item => {

        if (item.game === "Steam") {
            item.game_icon = "/front/svg/steam_icon.svg";
        }
        else if(item.game === "Counter-Strike 2"){
            item.game_icon = "/front/svg/cs2_icon.svg";
        }
        else if(item.game === "Dota 2"){
            item.game_icon = "/front/svg/dota2_icon.svg";
        }

        // if(filters){
            container.insertAdjacentHTML("afterbegin", `
    <div class="card">
        <div class="card-details">
            <div class="card_hover-container">
                <img class="game_icon" src="${item.game_icon}">
                <span class="hidden-text">${item.game}</span>
            </div>
            <div>

            <div class="card_tooltip-container">
                <img class="more_icon" src="/front/svg/more_icon.svg">

                <span class="tooltip_actions">
                    <a href="https://steamcommunity.com/market/listings/${item.appid}/${item.market_hash_name}"
                    target="_blank" rel="noopener noreferrer">
                    <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                    </a>
                    <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                </span>
            </div>
            <div style="overflow: hidden;">
            <img src="https://steamcommunity.com/economy/image/${ item.icon }" alt="${ item.name }" class="item_icon">
            </div>
            </div>
            <div class="card_hover-container">
            <span class="text-title">${item.name}</span>
            <span class="hidden-text">${item.name}</span>
            </div>
            <span class="text-price">$${item.price}</span>
        </div>
    </div>
`);
        // }
        

    });
};
</script>


<!-- === INITIAL TERA RENDER === -->
<div class="side_panel">
</div>
<div id="items-container" class="items-container">    
{% for item in most_recent_items %}
        <div class="card">
            <div class="card-details">
                <span class="text-price">${{ item.price }}</span>

                <div class="card_tooltip-container">
                    <img class="more_icon" src="/front/svg/more_icon.svg">
    
                    <span class="tooltip_actions">
                        <a href="https://steamcommunity.com/market/listings/{{item.appid}}/{{item.market_hash_name}}"
                        target="_blank" rel="noopener noreferrer">
                        <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                        </a>
                        <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                    </span>
                </div>

                {% if item.tradable == "1" %}
                <img class="locker_icon" src="/front/svg/locker_icon.svg">
                {% endif %}
                
                <div class="card_hover-container">
                    {% if item.game == "Steam" %}
                    <img class="game_icon" src="/front/svg/steam_icon.svg">
                    {% elif item.game == "Counter-Strike 2" %}
                        <img class="game_icon" src="/front/svg/cs2_icon.svg">
                    {% elif item.game == "Dota 2" %}
                        <img class="game_icon" src="/front/svg/dota2_icon.svg">
                    {% else %}
                        <img class="game_icon" src="{{ item.game_icon }}">
                    {% endif %}
                <span class="hidden-text">{{item.game}}</span>
                </div>
                <div style="display: flex;
                box-sizing: content-box;">
                    <img src="https://steamcommunity.com/economy/image/{{ item.icon }}" alt="{{ item.name }}" class="item_icon">
                </div>
                <div class="card_hover-container">
                <span class="text-title">{{ item.name }}</span>
                <span class="hidden-text">{{item.name}}</span>
                </div>
            </div>
        </div>
{% endfor %}
</div>

</body>
</html>
