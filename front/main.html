<!DOCTYPE html>
<html>
<head>
    <title>Realtime Cards</title>

<style>
/* ==== Your card CSS (unchanged) ==== */
.card {
 width: 80px;
 height: 90px;
 border-radius: 10px;
 background: #212121;
 position: relative;
 padding: 1.8rem;
 border: 1px solid #323232;
 transition: 0.5s ease-out;
 /* overflow: hidden; */
 margin: 0.4rem;
}
.card-details {
 color: black;
 height: 100%;
 gap: .5em;
 display: grid;
 place-content: center;
 
}
.card-button {
 transform: translate(-50%, 125%);
 width: 60%;
 border-radius: 1rem;
 border: none;
 background-color: #72addb;
 color: #fff;
 font-size: 1rem;
 padding: .5rem 1rem;
 position: absolute;
 left: 50%;
 bottom: 0;
 opacity: 0;
 transition: 0.3s ease-out;
}
.game_icon{
    position: absolute;
    top: 7px;
    right: 25px;
    width: 16px;
    height: 16px;
}

.more_icon{
    position: absolute;
    top: 7px;
    right: 5px;
    width: 16px;
    height: 16px;
}

.tooltip_icon{
    cursor: pointer;
    /* position: absolute;
    top: 5px;
    right: 5px; */
    width: 16px;
    height: 16px; 
}

.locker_icon{
    position: absolute;
    top: 5px;
    left: 5px;
    width: 16px;
    height: 16px;
}

.text-price {
 color: #9E9E9E;
 /* font-size: 0.5em; */
 font-size: 0.7em;
 position: absolute;
 /* top: 5px;
 left: 5px; */
 bottom: 9px;
 justify-self: center;
}
.text-title {
 padding-left: 5px;
 padding-right: 5px;
 font-size: 0.6em;
 font-weight: bold;
 position: absolute;
 justify-self: center;
 bottom: 10px;
 color: #F9F8F6;
}
.card_hover-container {
  /* position: relative; */
  display: inline-block;
  /* display: flex; */
  cursor: default;

}

.hidden-text {
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 5px 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 10;
}

.tooltip_actions{
  position: absolute;
  bottom: 80%;
  left: 112%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  font-size: 8pt;
  gap: 0.5em;
  visibility: hidden;
  display: flex;          
  flex-direction: column; 
  align-items: center; 
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 10;
}

.card_tooltip-container:hover .tooltip_actions {
  opacity: 1;
  visibility: visible;
}

.card_hover-container:hover .hidden-text {
  opacity: 1;
  visibility: visible;
}

.card:hover {
 border-color: #E69066;
 box-shadow: 0 4px 18px 0 rgba(0, 0, 0, 0.25);
}
.card:hover .card-button {
 transform: translate(-50%, 50%);
 opacity: 1;
}

.side_panel_icons{
  display: flex;          
  flex-direction: column; 
  align-items: center; 
}

.side_panel_icon{
    margin-top: 20px;
    width: 20px;
    height: 20px;
    z-index: 100;
}

.side_panel_icons:hover .filters{
    opacity: 1;
    visibility: visible;
}

.filters{
    visibility: hidden;
    margin: auto;
}

.item_icon{
    padding-left: 5px;
    padding-right: 5px;
    width: auto;
    height: 70px;
    /* position: absolute; */
    justify-self: center;
    align-self: center;    
}
.side_panel {
    position: fixed;
    left: 0;
    top: 0;
    width: 3%;
    height: 100vh;
    background: #141414;
    border: 1px solid #323232;
    color: white;
    /* padding: 20px; */
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    z-index: 100;
}

.items-container {
        width: 95%;
        padding: 20px;
        margin-left: auto;
        display: flex;
        justify-content: center;
        /* justify-self: center; */
        flex-wrap: wrap;
}
</style>

</head>

<body style="background-color: #141414;
overflow-x: hidden;">

<script>
const ws = new WebSocket("ws://127.0.0.1:8080/ws");

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    const filters = data.filters;
    const items = data.items;
    console.log("Received update:", items);

    const container = document.getElementById("items-container");

    items.forEach(item => {

        if (item.game === "Steam") {
            item.game_icon = "/front/svg/steam_icon.svg";
        }
        else if(item.game === "Counter-Strike 2"){
            item.game_icon = "/front/svg/cs2_icon.svg";
        }
        else if(item.game === "Dota 2"){
            item.game_icon = "/front/svg/dota2_icon.svg";
        }

        if(filters.appid === item.game){
            container.insertAdjacentHTML("afterbegin", `
    <div class="card_hover-container">
        <div class="card">
            <div class="card-details">
                <div class="card_hover-container">
                    <img class="game_icon" src="${item.game_icon}">
                    <span class="hidden-text">${item.game}</span>
                </div>
            <div>

            <div class="card_tooltip-container">
                <img class="more_icon" src="/front/svg/more_icon.svg">

                <span class="tooltip_actions">
                    <a href="https://steamcommunity.com/market/listings/${item.appid}/${item.market_hash_name}"
                    target="_blank" rel="noopener noreferrer">
                    <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                    </a>
                    <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                </span>
            </div>
            <div style="overflow: hidden;">
            <img src="https://steamcommunity.com/economy/image/${ item.icon }" alt="${ item.name }" class="item_icon">
            </div>
            </div>
            <span class="hidden-text">${item.name}</span>
            <span class="text-price">$${item.price}</span>
            </div>
        </div>
    </div>
`);
        }
        

    });
};
</script>

<script>
    function updateFilters() {
    
        const appid = document.getElementById("f_appid").value;
        const price_min = document.getElementById("f_min").value;
        const price_max = document.getElementById("f_max").value;
        const query = document.getElementById("f_query").value;
    
        const url = `/filters?appid=${appid}&price_min=${price_min}&price_max=${price_max}&query=${query}`;
    
        fetch(url)
            .then(res => res.json())
            .then(json => {
                console.log("Filters updated:", json);
            });
    }
    </script>
    

<!-- === INITIAL TERA RENDER === -->
<div class="side_panel">
    <div class="side_panel_icons">
        <img class="side_panel_icon" src="/front/svg/filter_icon.svg">


        <div class="filters">
            <label>Game:</label>
            <input id="f_appid" type="text">
    
            <label>Price Min:</label>
            <input id="f_min" type="number" value="10">
        
            <label>Price Max:</label>
            <input id="f_max" type="number" value="200">
        
            <label>Query:</label>
            <input id="f_query" type="text">
        
            <button onclick="updateFilters()">Apply</button>
        </div>
    </div>
    
</div>
<div id="items-container" class="items-container">    
{% for item in most_recent_items %}
        {% if filters.appid == item.game %}
        <div class="card_hover-container">

        <div class="card">
            <div class="card-details">
                <span class="text-price">${{ item.price }}</span>

                <div class="card_tooltip-container">
                    <img class="more_icon" src="/front/svg/more_icon.svg">
    
                    <span class="tooltip_actions">
                        <a href="https://steamcommunity.com/market/listings/{{item.appid}}/{{item.market_hash_name}}"
                        target="_blank" rel="noopener noreferrer">
                        <img class="tooltip_icon" src="/front/svg/grab_icon.svg">
                        </a>
                        <img class="tooltip_icon" src="/front/svg/info_icon.svg">
                    </span>
                </div>

                {% if item.tradable == "1" %}
                <img class="locker_icon" src="/front/svg/locker_icon.svg">
                {% endif %}
                
                <div class="card_hover-container">
                    {% if item.game == "Steam" %}
                    <img class="game_icon" src="/front/svg/steam_icon.svg">
                    {% elif item.game == "Counter-Strike 2" %}
                        <img class="game_icon" src="/front/svg/cs2_icon.svg">
                    {% elif item.game == "Dota 2" %}
                        <img class="game_icon" src="/front/svg/dota2_icon.svg">
                    {% else %}
                        <img class="game_icon" src="{{ item.game_icon }}">
                    {% endif %}
                <span class="hidden-text">{{item.game}}</span>
                </div>
                <div style="display: flex;
                box-sizing: content-box;">
                    <img src="https://steamcommunity.com/economy/image/{{ item.icon }}" alt="{{ item.name }}" class="item_icon">
                </div>
                <!-- <span class="text-title">{{ item.name }}</span> -->
                <span class="hidden-text">{{item.name}}</span>
            </div>
        </div>

        </div>
        {% endif %}
{% endfor %}
</div>
</div>

</body>
</html>
